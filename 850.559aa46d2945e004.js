(()=>{"use strict";function h(n,e,t,s,r,o,i){try{var a=n[o](i),l=a.value}catch(y){return void t(y)}a.done?e(l):Promise.resolve(l).then(s,r)}function c(n){return function(){var e=this,t=arguments;return new Promise(function(s,r){var o=n.apply(e,t);function i(l){h(o,s,r,i,a,"next",l)}function a(l){h(o,s,r,i,a,"throw",l)}i(void 0)})}}class p{constructor(e){this.baseUrl=e,this.pyodidePromise=this.prepareEnv()}prepareEnv(){var e=this;return c(function*(){let t=yield loadPyodide();yield t.loadPackage("micropip");const r=e.baseUrl+"/assets/python/codebase-0.0.1-py3-none-any.whl";let o=yield t.runPythonAsync(`import micropip; await micropip.install('${r}'); str(micropip.list())`);return console.log(o),t})()}select(e,t){var s=this;return c(function*(){let r,o;try{let i=yield s.pyodidePromise;void 0!==s.pyconsole&&(yield s.close()),r=i.globals.get("dict")();let a=i.toPy(t);r.update(a),a.destroy(),yield i.loadPackagesFromImports(e),i.runPython(e,{globals:r}),o=r.get("instance");let l=o.console.copy();l.globals.update(r),l.stdout_callback=y=>p.stdCallback(y.trim(),!1),l.stderr_callback=y=>p.stdCallback(y.trim(),!0),s.pyconsole=l}finally{r?.destroy(),o?.destroy()}})()}run(e,t){var s=this;return c(function*(){if(void 0===s.pyconsole)throw new Error("No script selected");yield s.setParams(t);const r=yield s.pyconsole.push(e);if((yield s.pyodidePromise).isPyProxy(r)){let i=r.toJs({create_pyproxies:!1,dict_converter:Object.fromEntries});return r.destroy(),i}return yield s.clearParams(t),r})()}setParams(e){var t=this;return c(function*(){let r=(yield t.pyodidePromise).toPy(e),o=t.pyconsole.globals.get("instance").__dict__;o.update(r),r.destroy(),console.log(o.keys().__str__())})()}clearParams(e){var t=this;return c(function*(){let s=yield t.pyodidePromise,r=t.pyconsole.globals.get("instance").__dict__;for(let o of Object.keys(e)){let i=s.toPy(o);r.pop(i)}console.log(r.keys().__str__())})()}close(){var e=this;return c(function*(){if(void 0===e.pyconsole)throw new Error("No script selected");e.pyconsole.destroy()})()}static stdCallback(e,t){e&&postMessage({action:"output",content:e,isError:t})}}importScripts("https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js");let u,d=!1;function f(){return(f=c(function*(n){u=new p(n.baseUrl)})).apply(this,arguments)}addEventListener("message",({data:n})=>{if(d)throw new Error("Worker is already busy");try{let e=function m(n){if(void 0===u){if("init"!==n.action)throw new Error("Worker not initialized");return function _(n){return f.apply(this,arguments)}(n)}switch(n.action){case"select":return u.select(n.code,n.data);case"run":return u.run(n.expression,n.params)}throw new RangeError}(n);d=!0,e.then(t=>{(function g(n){postMessage(n)})({action:"result",content:t}),d=!1},t=>{throw d=!1,t})}catch(e){throw d=!1,e}})})();