"use strict";(self.webpackChunkAIPlayground=self.webpackChunkAIPlayground||[]).push([[884],{6884:(k,g,a)=>{a.r(g),a.d(g,{DigitRecognitionModule:()=>A});var c=a(6895),h=a(9116),v=a(5861),t=a(4650);function m(n){return{x:n.clientX,y:n.clientY}}function p(n){return{x:n.targetTouches[0].clientX,y:n.targetTouches[0].clientY}}let y=(()=>{class n{constructor(e){this.document=e,this.dragging=!1,this.position={x:0,y:0},this.dragEmitter=new t.vpe,this.touchEndEmitter=new t.vpe,e.addEventListener("mousedown",o=>{this.position=m(o),this.touchStart()}),e.addEventListener("touchstart",o=>{this.position=p(o),this.touchStart()}),e.addEventListener("mousemove",o=>{this.position=m(o),this.touchMove()}),e.addEventListener("touchmove",o=>{this.position=p(o),this.touchMove()}),e.addEventListener("mouseup",()=>{this.touchEnd()}),e.addEventListener("touchend",()=>{this.touchEnd()}),e.addEventListener("mouseleave",()=>{this.touchEnd()}),e.addEventListener("touchcancel",()=>{this.touchEnd()})}touchStart(){this.dragging=!0,this.dragEmitter.emit(this.position)}touchMove(){this.dragging&&this.dragEmitter.emit(this.position)}touchEnd(){this.dragging=!1,this.touchEndEmitter.emit()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(c.K0))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var M=a(7056),S=a(1702),w=a(3917),f=a(4859),E=a(7392);const b=["canvasElement"],D=["resizeCanvasElement"];function T(n,s){1&n&&(t.ynx(0),t._uU(1,"Predict"),t.BQk())}function x(n,s){1&n&&(t.ynx(0),t._uU(1,"Loading"),t.BQk())}function P(n,s){1&n&&(t.ynx(0),t._uU(1,"Predicting"),t.BQk())}function I(n,s){if(1&n&&(t.TgZ(0,"div",10),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.result)}}const C=!!function Z(){let n=!1;try{let s=Object.defineProperty({},"passive",{get:function(){n=!0}}),e="testPassive",o=null;window.addEventListener(e,o,s),window.removeEventListener(e,o,s)}catch{}return n}()&&{passive:!1},z=[{path:"",component:(()=>{class n{constructor(e,o,i,r,l){this.touchService=e,this.drawerService=o,this.pythonRunner=i,this.aiReposService=r,this.document=l,this.state="idle",this.touchStartedInCanvas=!1,this.preventMobileScrolling=this.preventMobileScrolling.bind(this),window.addEventListener("touchmove",this.preventMobileScrolling,C)}ngOnDestroy(){window.removeEventListener("touchmove",this.preventMobileScrolling,C)}ngAfterViewInit(){var e=this;return(0,v.Z)(function*(){let o=e.canvasElement.nativeElement;o.addEventListener("touchstart",()=>{e.touchStartedInCanvas=!0}),o.addEventListener("mousedown",()=>{e.touchStartedInCanvas=!0});let i=o.getContext("2d");e.touchService.dragEmitter.subscribe(({x:r,y:l})=>{if(!e.touchStartedInCanvas)return;let u=o.getBoundingClientRect(),d=r-u.left,R=l-u.top;void 0!==e.prevPos&&(i.beginPath(),i.moveTo(e.prevPos.x,e.prevPos.y),i.lineTo(d,R),i.lineWidth=6,i.strokeStyle="black",i.shadowColor="black",i.shadowBlur=4,i.lineCap="round",i.lineJoin="round",i.stroke(),i.closePath()),e.prevPos={x:d,y:R}}),e.touchService.touchEndEmitter.subscribe(()=>{e.prevPos=void 0,e.touchStartedInCanvas=!1})})()}clear(){this.canvasElement.nativeElement.getContext("2d").clearRect(0,0,112,112)}predict(){var e=this;return(0,v.Z)(function*(){console.log("Loading"),e.state="loading",yield e.pythonRunner.loadScript("digit_recognition"),yield e.aiReposService.loadModel("digit_recognition",e.pythonRunner),console.log("Predicting"),e.state="predicting";let o=e.getResizedImage(),i=yield e.pythonRunner.run("instance.eval()",{inputs:o});e.result=function L(n){let s=(n=n.map(Math.exp)).reduce((i,r)=>i+r),e=n.map((i,r)=>[r,i/s]);e.sort((i,r)=>r[1]-i[1]);let o=e.filter(([,i])=>i>.15).map(([i])=>i);return 0===o.length?"I have no idea":1===o.length?"I'm certain this is a "+o[0]:"I think this is a "+o[0]+" but it could also be "+o.slice(1).join(", ")}(i),e.state="idle"})()}getResizedImage(){let e=this.canvasElement.nativeElement,i=this.resizeCanvasElement.nativeElement.getContext("2d");i.clearRect(0,0,28,28),i.drawImage(e,0,0,28,28);let l=i.getImageData(0,0,28,28,{colorSpace:"srgb"}).data.filter((u,d)=>d%4==3);return Array.from(l.values()).map(u=>u/255)}preventMobileScrolling(e){this.touchStartedInCanvas&&e.preventDefault()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(y),t.Y36(M.z),t.Y36(S.Z),t.Y36(w.f),t.Y36(c.K0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-digit-recognition-main"]],viewQuery:function(e,o){if(1&e&&(t.Gf(b,5),t.Gf(D,5)),2&e){let i;t.iGM(i=t.CRH())&&(o.canvasElement=i.first),t.iGM(i=t.CRH())&&(o.resizeCanvasElement=i.first)}},decls:18,vars:6,consts:[[1,"canvas-container"],[1,"d-flex"],["width","112","height","112"],["canvasElement",""],["mat-icon-button","",3,"click"],["width","28","height","28",1,"d-none"],["resizeCanvasElement",""],["mat-raised-button","","color","primary",3,"disabled","ngSwitch","click"],[4,"ngSwitchCase"],["class","ms-1",4,"ngIf"],[1,"ms-1"]],template:function(e,o){1&e&&(t.TgZ(0,"h2"),t._uU(1,"Handwritten Digit Recognition"),t.qZA(),t.TgZ(2,"div",0)(3,"p"),t._uU(4,"Instructions: draw a single digit in the center of the canvas below"),t.qZA(),t.TgZ(5,"div",1),t._UZ(6,"canvas",2,3),t.TgZ(8,"button",4),t.NdJ("click",function(){return o.clear()}),t.TgZ(9,"mat-icon"),t._uU(10,"delete_outline"),t.qZA()()(),t._UZ(11,"canvas",5,6),t.qZA(),t.TgZ(13,"button",7),t.NdJ("click",function(){return o.predict()}),t.YNc(14,T,2,0,"ng-container",8),t.YNc(15,x,2,0,"ng-container",8),t.YNc(16,P,2,0,"ng-container",8),t.qZA(),t.YNc(17,I,2,1,"div",9)),2&e&&(t.xp6(13),t.Q6J("disabled","idle"!==o.state)("ngSwitch",o.state),t.xp6(1),t.Q6J("ngSwitchCase","idle"),t.xp6(1),t.Q6J("ngSwitchCase","loading"),t.xp6(1),t.Q6J("ngSwitchCase","predicting"),t.xp6(1),t.Q6J("ngIf",void 0!==o.result))},directives:[f.lW,E.Hw,c.RF,c.n9,c.O5],styles:[".canvas-container[_ngcontent-%COMP%]{margin-bottom:1rem}canvas[_ngcontent-%COMP%]{border:solid black .1rem;background-color:#fff}"]}),n})()}];let Y=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[h.Bz.forChild(z)],h.Bz]}),n})(),A=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[c.ez,Y,f.ot,E.Ps]]}),n})()}}]);