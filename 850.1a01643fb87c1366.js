(()=>{"use strict";function h(s,e,t,r,n,l,i){try{var a=s[l](i),o=a.value}catch(p){return void t(p)}a.done?e(o):Promise.resolve(o).then(r,n)}function c(s){return function(){var e=this,t=arguments;return new Promise(function(r,n){var l=s.apply(e,t);function i(o){h(l,r,n,i,a,"next",o)}function a(o){h(l,r,n,i,a,"throw",o)}i(void 0)})}}class d{constructor(e,t){this.libs=e,this.libsArchives=t,this.pyodidePromise=this.prepareEnv()}prepareEnv(){var e=this;return c(function*(){let t=yield loadPyodide();yield t.loadPackage(e.libs,r=>d.stdCallback(r.trim(),!1),r=>d.stdCallback(r.trim(),!0));for(const r of e.libsArchives)yield t.unpackArchive(r,"wheel");return t})()}select(e,t){var r=this;return c(function*(){let n,l;try{let i=yield r.pyodidePromise;void 0!==r.pyconsole&&(yield r.close()),n=i.globals.get("dict")();let a=i.toPy(t);n.update(a),a.destroy(),yield i.loadPackagesFromImports(e),i.runPython(e,{globals:n}),l=n.get("instance");let o=l.console.copy();o.globals.update(n),o.stdout_callback=p=>d.stdCallback(p.trim(),!1),o.stderr_callback=p=>d.stdCallback(p.trim(),!0),r.pyconsole=o}finally{n?.destroy(),l?.destroy()}})()}run(e,t){var r=this;return c(function*(){if(void 0===r.pyconsole)throw new Error("No script selected");yield r.setParams(t);const n=yield r.pyconsole.push(e);if((yield r.pyodidePromise).isPyProxy(n)){let i=n.toJs({create_pyproxies:!1,dict_converter:Object.fromEntries});return n.destroy(),i}return yield r.clearParams(),n})()}setParams(e){var t=this;return c(function*(){let n=(yield t.pyodidePromise).toPy(e);t.pyconsole.globals.get("instance").params.update(n),n.destroy()})()}clearParams(){var e=this;return c(function*(){e.pyconsole.globals.get("instance").params.clear()})()}close(){var e=this;return c(function*(){if(void 0===e.pyconsole)throw new Error("No script selected");e.pyconsole.destroy()})()}static stdCallback(e,t){e&&postMessage({action:"output",content:e,isError:t})}}importScripts("https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js");let y,u=!1;function f(){return(f=c(function*(s){y=new d(s.libs,s.libsArchives)})).apply(this,arguments)}addEventListener("message",({data:s})=>{if(u)throw new Error("Worker is already busy");try{let e=function b(s){if(void 0===y){if("init"!==s.action)throw new Error("Worker not initialized");return function m(s){return f.apply(this,arguments)}(s)}switch(s.action){case"select":return y.select(s.code,s.params);case"run":return y.run(s.expression,s.params)}throw new RangeError}(s);u=!0,e.then(t=>{(function v(s){postMessage(s)})({action:"result",content:t}),u=!1},t=>{throw u=!1,t})}catch(e){throw u=!1,e}})})();