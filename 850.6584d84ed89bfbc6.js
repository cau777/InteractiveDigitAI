(()=>{"use strict";function u(n,r,e,s,t,o,i){try{var a=n[o](i),l=a.value}catch(m){return void e(m)}a.done?r(l):Promise.resolve(l).then(s,t)}function c(n){return function(){var r=this,e=arguments;return new Promise(function(s,t){var o=n.apply(r,e);function i(l){u(o,s,t,i,a,"next",l)}function a(l){u(o,s,t,i,a,"throw",l)}i(void 0)})}}function y(n){if(void 0===n)throw new ReferenceError("load() should be called first")}function p(n,r){n&&postMessage({action:"output",content:n,isError:r})}importScripts("https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js");let d=new class f{load(r,e,s){var t=this;return c(function*(){let o=yield loadPyodide();yield o.loadPackage(r,i=>s(i.trim(),!1),i=>s(i.trim(),!0));for(const i of e)o.unpackArchive(i,"wheel");t.pyodide=o})()}select(r,e){var s=this;return c(function*(){let t,o;y(s.pyodide);try{let i=s.pyodide;void 0!==s.console&&s.console.destroy(),t=i.globals.get("dict")();let a=i.toPy(e);t.update(a),a.destroy(),yield i.loadPackagesFromImports(r),i.runPython(r,{globals:t}),o=t.get("instance");let l=o.console.copy();l.globals.update(t),s.console=l}finally{t?.destroy(),o?.destroy()}})()}run(r,e,s){var t=this;return c(function*(){if(y(t.pyodide),void 0===t.console)throw new Error("No script selected");t.setCallback(s),yield t.setParams(e);const o=yield t.console.push(r);if((yield t.pyodide).isPyProxy(o)){let a=o.toJs({create_pyproxies:!1,dict_converter:Object.fromEntries});return o.destroy(),a}return yield t.clearParams(),o})()}setParams(r){var e=this;return c(function*(){let s=e.pyodide.toPy(r);e.console.globals.get("instance").params.update(s),s.destroy()})()}clearParams(){var r=this;return c(function*(){r.console.globals.get("instance").params.clear()})()}setCallback(r){void 0!==r&&(this.console.stdout_callback=e=>r(e.trim(),!1),this.console.stderr_callback=e=>r(e.trim(),!0))}};addEventListener("message",({data:n})=>{(function h(n){switch(n.action){case"load":return d.load(n.libs,n.libsArchives,p);case"select":return d.select(n.code,n.params);case"run":return d.run(n.expression,n.params,p)}throw new RangeError(n.action)})(n).then(e=>{postMessage({action:"result",content:e})},e=>{throw e})})})();