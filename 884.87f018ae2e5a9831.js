"use strict";(self.webpackChunkAIPlayground=self.webpackChunkAIPlayground||[]).push([[884],{6884:(J,h,r)=>{r.r(h),r.d(h,{DigitRecognitionModule:()=>O});var u=r(6895),v=r(9116),m=r(5861),S=r(3905),t=r(4650);function p(n){return{x:n.clientX,y:n.clientY}}function f(n){return{x:n.targetTouches[0].clientX,y:n.targetTouches[0].clientY}}let M=(()=>{class n{constructor(e){this.document=e,this.dragging=!1,this.position={x:0,y:0},this.dragEmitter=new t.vpe,this.touchEndEmitter=new t.vpe,e.addEventListener("mousedown",i=>{this.position=p(i),this.touchStart()}),e.addEventListener("touchstart",i=>{this.position=f(i),this.touchStart()}),e.addEventListener("mousemove",i=>{this.position=p(i),this.touchMove()}),e.addEventListener("touchmove",i=>{this.position=f(i),this.touchMove()}),e.addEventListener("mouseup",()=>{this.touchEnd()}),e.addEventListener("touchend",()=>{this.touchEnd()}),e.addEventListener("mouseleave",()=>{this.touchEnd()}),e.addEventListener("touchcancel",()=>{this.touchEnd()})}touchStart(){this.dragging=!0,this.dragEmitter.emit(this.position)}touchMove(){this.dragging&&this.dragEmitter.emit(this.position)}touchEnd(){this.dragging=!1,this.touchEndEmitter.emit()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(u.K0))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var x=r(7056),D=r(1702),w=r(3917),d=r(6188),C=r(4859),E=r(7392);const T=["canvasElement"],Z=["resizeCanvasElement"];function L(n,s){1&n&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Predict")))}function P(n,s){1&n&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Loading")))}function b(n,s){1&n&&(t.ynx(0),t._uU(1),t.ALo(2,"translate"),t.BQk()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"Common.Predicting")))}function A(n,s){if(1&n&&(t.TgZ(0,"div",10),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.result)}}const R=!!function I(){let n=!1;try{let s=Object.defineProperty({},"passive",{get:function(){n=!0}}),e="testPassive",i=null;window.addEventListener(e,i,s),window.removeEventListener(e,i,s)}catch{}return n}()&&{passive:!1},z=[{path:"",component:(()=>{class n{constructor(e,i,o,l,a,c){this.touchService=e,this.drawerService=i,this.pythonRunner=o,this.aiReposService=l,this.translateService=a,this.document=c,this.state="idle",this.touchStartedInCanvas=!1,this.preventMobileScrolling=this.preventMobileScrolling.bind(this),window.addEventListener("touchmove",this.preventMobileScrolling,R)}ngOnDestroy(){window.removeEventListener("touchmove",this.preventMobileScrolling,R)}ngAfterViewInit(){var e=this;return(0,m.Z)(function*(){let i=e.canvasElement.nativeElement;i.addEventListener("touchstart",()=>{e.touchStartedInCanvas=!0}),i.addEventListener("mousedown",()=>{e.touchStartedInCanvas=!0});let o=i.getContext("2d");e.touchService.dragEmitter.subscribe(({x:l,y:a})=>{if(!e.touchStartedInCanvas)return;let c=i.getBoundingClientRect(),g=l-c.left,y=a-c.top;void 0!==e.prevPos&&(o.beginPath(),o.moveTo(e.prevPos.x,e.prevPos.y),o.lineTo(g,y),o.lineWidth=6,o.strokeStyle="black",o.shadowColor="black",o.shadowBlur=4,o.lineCap="round",o.lineJoin="round",o.stroke(),o.closePath()),e.prevPos={x:g,y}}),e.touchService.touchEndEmitter.subscribe(()=>{e.prevPos=void 0,e.touchStartedInCanvas=!1})})()}clear(){this.canvasElement.nativeElement.getContext("2d").clearRect(0,0,112,112)}predict(){var e=this;return(0,m.Z)(function*(){console.log("Loading"),e.state="loading";try{yield e.pythonRunner.loadScript("digit_recognition"),yield e.aiReposService.loadModel("digit_recognition",e.pythonRunner),console.log("Predicting"),e.state="predicting";let i=e.getResizedImage(),o=yield e.pythonRunner.run("instance.eval()",{inputs:i});e.result=yield(0,S.z)(e.formatPredictions(o)),e.state="idle"}catch(i){alert(i)}})()}getResizedImage(){let e=this.canvasElement.nativeElement,o=this.resizeCanvasElement.nativeElement.getContext("2d");o.clearRect(0,0,28,28),o.drawImage(e,0,0,28,28);let a=o.getImageData(0,0,28,28,{colorSpace:"srgb"}).data.filter((c,g)=>g%4==3);return Array.from(a.values()).map(c=>c/255)}preventMobileScrolling(e){this.touchStartedInCanvas&&e.preventDefault()}formatPredictions(e){let i=(e=e.map(Math.exp)).reduce((a,c)=>a+c),o=e.map((a,c)=>[c,a/i]);o.sort((a,c)=>c[1]-a[1]);let l=o.filter(([,a])=>a>.15).map(([a])=>a);return 0===l.length?this.translateService.get("DigitRecognition.Result0"):1===l.length?this.translateService.get("DigitRecognition.Result1",{value:l[0]}):this.translateService.get("DigitRecognition.Result2",{value:l[0],rest:l.slice(1).join(", ")})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(M),t.Y36(x.z),t.Y36(D.Z),t.Y36(w.f),t.Y36(d.sK),t.Y36(u.K0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-digit-recognition-main"]],viewQuery:function(e,i){if(1&e&&(t.Gf(T,5),t.Gf(Z,5)),2&e){let o;t.iGM(o=t.CRH())&&(i.canvasElement=o.first),t.iGM(o=t.CRH())&&(i.resizeCanvasElement=o.first)}},decls:20,vars:12,consts:[[1,"canvas-container"],[1,"d-flex"],["width","112","height","112"],["canvasElement",""],["mat-icon-button","",3,"click"],["width","28","height","28",1,"d-none"],["resizeCanvasElement",""],["mat-raised-button","","color","primary",3,"disabled","ngSwitch","click"],[4,"ngSwitchCase"],["class","ms-1",4,"ngIf"],[1,"ms-1"]],template:function(e,i){1&e&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div",0)(4,"p"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"div",1),t._UZ(8,"canvas",2,3),t.TgZ(10,"button",4),t.NdJ("click",function(){return i.clear()}),t.TgZ(11,"mat-icon"),t._uU(12,"delete_outline"),t.qZA()()(),t._UZ(13,"canvas",5,6),t.qZA(),t.TgZ(15,"button",7),t.NdJ("click",function(){return i.predict()}),t.YNc(16,L,3,3,"ng-container",8),t.YNc(17,P,3,3,"ng-container",8),t.YNc(18,b,3,3,"ng-container",8),t.qZA(),t.YNc(19,A,2,1,"div",9)),2&e&&(t.xp6(1),t.Oqu(t.lcZ(2,8,"DigitRecognition.Title")),t.xp6(4),t.Oqu(t.lcZ(6,10,"DigitRecognition.Instructions")),t.xp6(10),t.Q6J("disabled","idle"!==i.state)("ngSwitch",i.state),t.xp6(1),t.Q6J("ngSwitchCase","idle"),t.xp6(1),t.Q6J("ngSwitchCase","loading"),t.xp6(1),t.Q6J("ngSwitchCase","predicting"),t.xp6(1),t.Q6J("ngIf",void 0!==i.result))},directives:[C.lW,E.Hw,u.RF,u.n9,u.O5],pipes:[d.X$],styles:[".canvas-container[_ngcontent-%COMP%]{margin-bottom:1rem}canvas[_ngcontent-%COMP%]{border:solid black .1rem;background-color:#fff}"]}),n})()}];let Y=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[v.Bz.forChild(z)],v.Bz]}),n})(),O=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[u.ez,Y,C.ot,E.Ps,d.aw]]}),n})()}}]);