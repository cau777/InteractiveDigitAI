(()=>{"use strict";function h(s,e,t,r,n,a,i){try{var l=s[a](i),o=l.value}catch(u){return void t(u)}l.done?e(o):Promise.resolve(o).then(r,n)}function c(s){return function(){var e=this,t=arguments;return new Promise(function(r,n){var a=s.apply(e,t);function i(o){h(a,r,n,i,l,"next",o)}function l(o){h(a,r,n,i,l,"throw",o)}i(void 0)})}}class p{constructor(e){this.libs=e,this.pyodidePromise=this.prepareEnv()}prepareEnv(){var e=this;return c(function*(){let t=yield loadPyodide();for(const r of e.libs)yield t.unpackArchive(r,"wheel");return t})()}select(e,t){var r=this;return c(function*(){let n,a;try{let i=yield r.pyodidePromise;void 0!==r.pyconsole&&(yield r.close()),n=i.globals.get("dict")();let l=i.toPy(t);n.update(l),l.destroy(),yield i.loadPackagesFromImports(e),i.runPython(e,{globals:n}),a=n.get("instance");let o=a.console.copy();o.globals.update(n),o.stdout_callback=u=>p.stdCallback(u.trim(),!1),o.stderr_callback=u=>p.stdCallback(u.trim(),!0),r.pyconsole=o}finally{n?.destroy(),a?.destroy()}})()}run(e,t){var r=this;return c(function*(){if(void 0===r.pyconsole)throw new Error("No script selected");yield r.setParams(t);const n=yield r.pyconsole.push(e);if((yield r.pyodidePromise).isPyProxy(n)){let i=n.toJs({create_pyproxies:!1,dict_converter:Object.fromEntries});return n.destroy(),i}return yield r.clearParams(),n})()}setParams(e){var t=this;return c(function*(){let n=(yield t.pyodidePromise).toPy(e);t.pyconsole.globals.get("instance").params.update(n),n.destroy()})()}clearParams(){var e=this;return c(function*(){e.pyconsole.globals.get("instance").params.clear()})()}close(){var e=this;return c(function*(){if(void 0===e.pyconsole)throw new Error("No script selected");e.pyconsole.destroy()})()}static stdCallback(e,t){e&&postMessage({action:"output",content:e,isError:t})}}importScripts("https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js");let y,d=!1;function f(){return(f=c(function*(s){y=new p(s.libs)})).apply(this,arguments)}addEventListener("message",({data:s})=>{if(d)throw new Error("Worker is already busy");try{let e=function g(s){if(void 0===y){if("init"!==s.action)throw new Error("Worker not initialized");return function m(s){return f.apply(this,arguments)}(s)}switch(s.action){case"select":return y.select(s.code,s.data);case"run":return y.run(s.expression,s.params)}throw new RangeError}(s);d=!0,e.then(t=>{(function w(s){postMessage(s)})({action:"result",content:t}),d=!1},t=>{throw d=!1,t})}catch(e){throw d=!1,e}})})();