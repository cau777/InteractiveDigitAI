(()=>{"use strict";function h(r,e,t,s,n,l,i){try{var a=r[l](i),o=a.value}catch(u){return void t(u)}a.done?e(o):Promise.resolve(o).then(s,n)}function c(r){return function(){var e=this,t=arguments;return new Promise(function(s,n){var l=r.apply(e,t);function i(o){h(l,s,n,i,a,"next",o)}function a(o){h(l,s,n,i,a,"throw",o)}i(void 0)})}}class p{constructor(e,t){this.libs=e,this.libsArchives=t,this.pyodidePromise=this.prepareEnv()}prepareEnv(){var e=this;return c(function*(){let t=yield loadPyodide();yield t.loadPackage(e.libs);for(const s of e.libsArchives)yield t.unpackArchive(s,"wheel");return t})()}select(e,t){var s=this;return c(function*(){let n,l;try{let i=yield s.pyodidePromise;void 0!==s.pyconsole&&(yield s.close()),n=i.globals.get("dict")();let a=i.toPy(t);n.update(a),a.destroy(),yield i.loadPackagesFromImports(e),i.runPython(e,{globals:n}),l=n.get("instance");let o=l.console.copy();o.globals.update(n),o.stdout_callback=u=>p.stdCallback(u.trim(),!1),o.stderr_callback=u=>p.stdCallback(u.trim(),!0),s.pyconsole=o}finally{n?.destroy(),l?.destroy()}})()}run(e,t){var s=this;return c(function*(){if(void 0===s.pyconsole)throw new Error("No script selected");yield s.setParams(t);const n=yield s.pyconsole.push(e);if((yield s.pyodidePromise).isPyProxy(n)){let i=n.toJs({create_pyproxies:!1,dict_converter:Object.fromEntries});return n.destroy(),i}return yield s.clearParams(),n})()}setParams(e){var t=this;return c(function*(){let n=(yield t.pyodidePromise).toPy(e);t.pyconsole.globals.get("instance").params.update(n),n.destroy()})()}clearParams(){var e=this;return c(function*(){e.pyconsole.globals.get("instance").params.clear()})()}close(){var e=this;return c(function*(){if(void 0===e.pyconsole)throw new Error("No script selected");e.pyconsole.destroy()})()}static stdCallback(e,t){e&&postMessage({action:"output",content:e,isError:t})}}importScripts("https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js");let y,d=!1;function f(){return(f=c(function*(r){y=new p(r.libs,r.libsArchives)})).apply(this,arguments)}addEventListener("message",({data:r})=>{if(d)throw new Error("Worker is already busy");try{let e=function g(r){if(void 0===y){if("init"!==r.action)throw new Error("Worker not initialized");return function m(r){return f.apply(this,arguments)}(r)}switch(r.action){case"select":return y.select(r.code,r.data);case"run":return y.run(r.expression,r.params)}throw new RangeError}(r);d=!0,e.then(t=>{(function v(r){postMessage(r)})({action:"result",content:t}),d=!1},t=>{throw d=!1,t})}catch(e){throw d=!1,e}})})();